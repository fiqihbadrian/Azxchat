(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{103:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>x});var n=t(7876),l=t(4232),r=t(2692),c=t(1772),a=t(1041),i=t(4587),o=t.n(i),u=t(9452),d=t.n(u),m=t(5364);function x(){let e=(0,l.useRef)(null),s=(0,l.useRef)(null),t=(0,l.useRef)(null),[i,u]=(0,l.useState)([]),[x,h]=(0,l.useState)(""),[f,b]=(0,l.useState)(""),[g,p]=(0,l.useState)(!1),[j,N]=(0,l.useState)([]),[w,v]=(0,l.useState)(""),[y,k]=(0,l.useState)(!1),[C,E]=(0,l.useState)(!1),[S,_]=(0,l.useState)(!1),T=()=>{s.current&&s.current.scrollTo({top:s.current.scrollHeight,behavior:"smooth"})};(0,l.useEffect)(()=>{T()},[i]),(0,l.useEffect)(()=>{if(g)return t.current=(0,r.Ay)(m.env.BASE_URL,{path:"/api/socket"}),t.current.on("connect",()=>{var e,s;console.log("SOCKET CONNECTED!",null==(e=t.current)?void 0:e.id),null==(s=t.current)||s.emit("userJoined",f),N(e=>{var s,n;return[...e,{id:null!=(n=null==(s=t.current)?void 0:s.id)?n:"",name:f}]})}),t.current.on("userJoined",e=>{N(s=>s.some(s=>s.id===e.id)?s:[...s,e]),v("".concat(e.name," has joined the chat.")),setTimeout(()=>v(""),3e3)}),t.current.on("userLeft",e=>{N(s=>s.filter(s=>s.id!==e))}),t.current.on("users",e=>{N(e)}),t.current.on("message",e=>{"System"===e.user?(v(e.msg),setTimeout(()=>v(""),3e3)):u(s=>[...s,e])}),()=>{t.current&&(t.current.emit("userLeft",t.current.id),t.current.disconnect())}},[g,f]);let L=async()=>{if(x.trim()){var s,n;let l={user:f,msg:x};null==(s=t.current)||s.emit("message",l);try{(await fetch("/api/socket",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})).ok?h(""):console.error("Failed to send message to API")}catch(e){console.error("Error while sending message:",e)}finally{h(""),null==(n=e.current)||n.focus()}}};return(0,n.jsx)("div",{className:"flex flex-col w-full h-screen bg-base-200",children:g?(0,n.jsxs)("div",{className:"flex w-full",children:[(0,n.jsxs)("div",{className:"fixed lg:static transition-transform transform ".concat(S?"translate-x-0":"-translate-x-full"," lg:translate-x-0 w-64 lg:w-1/4 bg-base-300 p-4 h-screen z-50"),children:[(0,n.jsx)("button",{className:"lg:hidden absolute top-4 right-4 text-white",onClick:()=>_(!1),children:(0,n.jsx)(c.g,{icon:a.GRI,size:"lg"})}),(0,n.jsxs)("div",{className:"flex items-center mb-5",children:[(0,n.jsx)(o(),{src:"/images/logo.png",alt:"Logo Vercel",width:100,height:100}),(0,n.jsx)("h1",{className:"".concat(d().className," text-success text-xl font-bold"),children:"AZXchat"})]}),(0,n.jsx)("h4",{className:"text-xl text-white mb-4",children:"Users"}),(0,n.jsx)("ul",{className:"overflow-y-auto h-full",children:j.filter((e,s,t)=>t.findIndex(s=>s.id===e.id)===s).map(e=>(0,n.jsx)("li",{className:"text-white p-2 rounded mb-2 ".concat(e.name===f?"font-semibold bg-base-100":""," hover:bg-base-200"),children:e.name},e.id))})]}),(0,n.jsx)("button",{className:"lg:hidden fixed top-4 left-4 text-white z-50",onClick:()=>_(!0),children:(0,n.jsx)(c.g,{icon:a.ckx,size:"lg"})}),(0,n.jsxs)("div",{className:"flex-1 flex flex-col h-screen",children:[(0,n.jsx)("div",{className:"p-4 bg-base-100",children:w&&(0,n.jsx)("div",{className:"text-center text-sm text-gray-500 mb-3",children:w})}),(0,n.jsx)("div",{className:"flex-1 overflow-y-auto p-4 bg-base-100",ref:s,onScroll:()=>{if(s.current){let{scrollTop:e,scrollHeight:t,clientHeight:n}=s.current;E(!(e+n>=t-10))}},children:i.map((e,s)=>(0,n.jsxs)("div",{className:"flex items-center my-2",children:[(0,n.jsxs)("div",{className:"text-sm text-base-400 mr-2",children:[e.user,":"]}),(0,n.jsx)("div",{className:"bg-base-300 p-2 rounded text-white",children:e.msg})]},s))}),C&&(0,n.jsx)("button",{onClick:T,className:"btn btn-circle btn-success fixed bottom-20 right-11 z-10",children:(0,n.jsx)(c.g,{icon:a.B0C})}),(0,n.jsx)("div",{className:"p-4 bg-base-200",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("button",{className:"btn btn-default mr-2",onClick:()=>k(!y),children:(0,n.jsx)(c.g,{icon:a.Qpm})}),y&&(0,n.jsx)("div",{className:"absolute bottom-16 bg-base-300 p-2 rounded shadow-lg",children:(0,n.jsx)("div",{className:"grid grid-cols-6 gap-2",children:["\uD83D\uDE00","\uD83D\uDE02","\uD83D\uDE0D","\uD83D\uDE0E","\uD83D\uDE22","\uD83D\uDE21"].map(e=>(0,n.jsx)("span",{onClick:()=>{h(x+e),k(!1)},className:"cursor-pointer text-xl",children:e},e))})}),(0,n.jsx)("input",{ref:e,type:"text",placeholder:"Type here",value:x,onChange:e=>h(e.target.value),onKeyDown:e=>{"Enter"===e.key&&x.trim()&&L()},className:"text-white input input-bordered w-full h-12"}),(0,n.jsx)("button",{onClick:L,className:"btn btn-success ml-4 p-2 rounded-full",children:(0,n.jsx)(c.g,{icon:a.isI})})]})})]})]}):(0,n.jsxs)("div",{className:"flex flex-col justify-center items-center h-full w-full",children:[(0,n.jsx)(o(),{src:"/images/logo.png",alt:"Logo",width:100,height:100,className:"mb-4"}),(0,n.jsx)("h1",{className:"text-3xl font-semibold text-white mb-4",children:"Login to Chat"}),(0,n.jsx)("input",{type:"text",placeholder:"Enter your name",className:"input input-bordered bg-base-300 text-white p-2 rounded mt-4 mb-4 w-60 sm:w-80",onChange:e=>b(e.target.value),value:f,onKeyPress:e=>{"Enter"===e.key&&f&&p(!0)}}),(0,n.jsx)("button",{onClick:()=>f&&p(!0),className:"btn btn-success text-black mt-4 w-60 sm:w-80",children:"Login"})]})})}},6760:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(103)}])}},e=>{e.O(0,[725,230,636,593,792],()=>e(e.s=6760)),_N_E=e.O()}]);